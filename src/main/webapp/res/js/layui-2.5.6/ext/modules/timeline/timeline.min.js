/**

 @Name：layui.TimeLine TimeLine时间线
 @Author：000
 @License：MIT

 */
layui.define(["layer","jquery"],function(exports){var layer=layui.layer,$=layui.$,MOD_NAME="timeline",TIMELINE_CLASS="layui-timeline",TIMELINE_ITEM="layui-timeline-item",TIMELINE_BTN="layui-btn-sm",VERSION="v2.5.6",OPTIONS={},TimeLines={};var event={getElemId:function(options){var elem=options.elem||"";var obj=options.obj||$(elem);if(obj.length==0){return""}else{return $(obj)[0].id}},escape:function(html){if(typeof html!=="string"){return""}return html.replace(entityReg.escape,function(match){return entityMap.escape[match]})},unescape:function(str){if(typeof str!=="string"){return""}return str.replace(entityReg.unescape,function(match){return entityMap.unescape[match]})},cloneObj:function(obj,filter){var newObj={};if(obj instanceof Array){newObj=[]}var str="";if(typeof filter!=="undefined"){str=filter.join(",")}for(var key in obj){if(str.indexOf(key)==-1){var val=obj[key];newObj[key]=typeof val==="object"?event.cloneObj(val,typeof filter!==undefined?filter:[]):val}}return newObj},trimToDot:function(str){return str.replace(/ /g,".")},domExist:function($dom){if(typeof $dom!="undefined"&&$dom.length>=1){return true}return false}};var keys=Object.keys||function(obj){obj=Object(obj);var arr=[];for(var a in obj){arr.push(a)}return arr};var invert=function(obj){obj=Object(obj);var result={};for(var a in obj){result[obj[a]]=a}return result};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&quo;"}};entityMap.unescape=invert(entityMap.escape);var entityReg={escape:RegExp("["+keys(entityMap.escape).join("")+"]","g"),unescape:RegExp("("+keys(entityMap.unescape).join("|")+")","g")};var AjaxHelper={request:function(config){var data=config.data?config.data:{};var async=(typeof(config.async)==="boolean")?config.async:true;$.ajax({type:config.type?config.type:"POST",headers:config.headers,url:config.url,dataType:config.dataType?config.dataType:"json",data:data,async:async,contentType:config.contentType,xhrFields:{withCredentials:config.withCredentials},beforeSend:function(XMLHttpRequest,self){if(typeof(config.beforeSend)==="function"){return config.beforeSend(XMLHttpRequest,self)}return true},success:config.success,error:function(XMLHttpRequest,textStatus,errorThrown){if(typeof(config.error)==="function"){config.error(XMLHttpRequest,textStatus,errorThrown)}else{layer.msg("异步加载失败： "+textStatus,{icon:5,shift:6})}},statusCode:{404:function(){layer.msg("未找到指定请求，请检查访问路径！",{icon:5,shift:6})},500:function(){layer.msg("系统错误！",{icon:5,shift:6})}},complete:function(XMLHttpRequest,textStatus){if(typeof(config.complete)==="function"){config.complete(XMLHttpRequest,textStatus)}}})},serialize:function(first,param){var p=first;for(var key in param){p+=key+"="+param[key]+"&"}p=p.substring(0,p.length-1);return p}};var TimeLine=function(){this.config={linkHref:layui.cache.base+"timeline/timeline.css",itemSkin:TIMELINE_CLASS,itemClass:TIMELINE_ITEM,itemTitle:"+ New Date",itemContent:"+ New Content",version:VERSION};this.configs={};layui.link(this.config.linkHref)};TimeLine.prototype.setting=function(options){this.options=options||{};this.elem=this.options.elem||OPTIONS.elem||"";if(typeof this.options.obj==="undefined"){if(this.elem){if($(this.elem).length>0){this.obj=$(this.elem)}}}else{this.obj=this.options.obj||OPTIONS.obj||this.obj;this.elem="#"+this.obj[0].id}this.tpl_html=this.options.html||OPTIONS.html||"";this.tpl_id=this.options.id||OPTIONS.id||"";this.elem_dom=this.obj;this.tpl_url=this.options.url||OPTIONS.url||"";this.tpl_ajax=this.options.ajax||OPTIONS.ajax||"";this.tpl_data=this.options.data||OPTIONS.data||[];this.tpl_event=this.options.event||OPTIONS.event||null;this.tpl_step=this.options.step||OPTIONS.step||-1;this.url=this.options.url||OPTIONS.url||"";this.async=(typeof(this.options.async)==="boolean")?this.options.async:(typeof(OPTIONS.async)==="boolean")?OPTIONS.async:false;this.asyncLoad=this.options.asyncLoad||OPTIONS.asyncLoad||[];this.headers=this.options.headers||OPTIONS.headers||{};this.method=this.options.method||OPTIONS.method||"post";this.dataType=this.options.dataType||OPTIONS.dataType||"json";this.contentType=this.options.contentType||OPTIONS.contentType||"application/x-www-form-urlencoded";this.defaultRequest=$.extend(this.defaultRequest,this.options.defaultRequest||OPTIONS.defaultRequest)||this.defaultRequest;this.filterRequest=this.options.filterRequest||OPTIONS.filterRequest||[];this.request=this.options.request||OPTIONS.request||{};this.response=$.extend(this.response,this.options.response||OPTIONS.response)||this.response;this.data=this.options.data||OPTIONS.data||null;this.dataFormat=this.options.dataFormat||OPTIONS.dataFormat||"levelRelationship";this.dataStyle=this.options.dataStyle||OPTIONS.dataStyle||"defaultStyle";this.errDataShow=this.options.errDataShow||OPTIONS.errDataShow||false;this.withCredentials=this.options.withCredentials||OPTIONS.withCredentials||false;this.beforeSend=this.options.beforeSend||OPTIONS.beforeSend||function(ajax,XMLHttpRequest,self){return true};this.success=this.options.success||OPTIONS.success||function(data,obj,first){};
    this.done=this.options.done||OPTIONS.done||function(data,obj,first){};this.formatter=$.extend(this.formatter,this.options.formatter||OPTIONS.formatter)||this.formatter;this.error=this.options.error||OPTIONS.error||function(XMLHttpRequest,textStatus,errorThrown){};this.complete=this.options.complete||OPTIONS.complete||function(XMLHttpRequest,textStatus){}};TimeLine.prototype.reloadSetting=function(options){this.options=$.extend(this.options,options)||this.options;this.elem=this.options.elem||this.elem;if(typeof this.options.obj==="undefined"){if(this.elem){if($(this.elem).length>0){this.obj=$(this.elem)}}}else{this.obj=this.options.obj||this.obj;this.elem="#"+this.obj[0].id}this.tpl_html=this.options.html||OPTIONS.html||"";this.tpl_id=this.options.id||OPTIONS.id||"";this.elem_dom=this.obj;this.tpl_url=this.options.url||OPTIONS.url||"";this.tpl_ajax=this.options.ajax||OPTIONS.ajax||"";this.tpl_data=this.options.data||OPTIONS.data||[];this.tpl_event=this.options.event||OPTIONS.event||null;this.tpl_step=this.options.step||OPTIONS.step||-1;this.url=this.options.url||this.url;this.async=(typeof(this.options.async)==="boolean")?this.options.async:this.async;this.asyncLoad=this.options.asyncLoad||this.asyncLoad;this.headers=this.options.headers||this.headers;this.method=this.options.method||this.method;this.dataType=this.options.dataType||this.dataType;this.contentType=this.options.contentType||this.contentType;this.defaultRequest=$.extend(this.defaultRequest,this.options.defaultRequest)||this.defaultRequest;this.filterRequest=this.options.filterRequest||this.filterRequest;this.request=this.options.request||this.request;this.response=$.extend(this.response,this.options.response)||this.response;this.data=this.options.data||this.data;this.dataFormat=this.options.dataFormat||this.dataFormat;this.dataStyle=this.options.dataStyle||this.dataStyle;this.errDataShow=(typeof(this.options.errDataShow)==="boolean")?this.options.errDataShow:this.errDataShow;this.withCredentials=(typeof(this.options.withCredentials)==="boolean")?this.options.withCredentials:this.withCredentials;this.beforeSend=this.options.beforeSend||this.beforeSend;this.success=this.options.success||this.success;this.done=this.options.done||this.done;this.formatter=$.extend(this.formatter,this.options.formatter)||this.formatter;this.error=this.options.error||this.error;this.complete=this.options.complete||this.complete};TimeLine.prototype.reload=function(options){var _this=this;_this.reloadSetting(options);_this.init()};TimeLine.prototype.init=function(){var _this=this;if(typeof _this!=="object"){layer.msg("时间线组件未成功加载，请检查配置",{icon:5});return}_this.template();_this.register();_this.compile();_this.bindEvent();if(this.tpl_step!=-1){_this.step(this.tpl_step)}};TimeLine.prototype.msgErrData=function(){var _this=this;if(_this.errData.length>0&&_this.errDataShow){var title="";for(var i=0;i<_this.errData.length;i++){var edata=_this.errData[i];title+="数据：【"+edata[_this.response.title]+"】中时间线id和上一时间线id值一致！ \n"}layer.msg(title,{icon:2,time:5000})}_this.errData=[]};TimeLine.prototype.getRequestParam=function(item){var _this=this;var request=_this.request,defaultRequestNames=_this.defaultRequest,_item=item||_this.timelineItem,requestParam={};for(var key in request){requestParam[key]=request[key]}for(var key in defaultRequestNames){var paramName=defaultRequestNames[key];var paramValue=_item[key];if(typeof paramValue==="boolean"){requestParam[paramName]=paramValue}else{if(paramValue){requestParam[paramName]=paramValue}}}return requestParam};TimeLine.prototype.getFilterRequestParam=function(requestParam){var _this=this;var filterRequest=_this.filterRequest;return event.cloneObj(requestParam,filterRequest)};TimeLine.prototype.bindEvent=function(){var _this=this;var btnClick={step:function($dom){var id=$dom.attr("id");_this.step(id)},confirm:function($dom){var id=_this.nextBtnId($dom);layer.alert(id-1,{title:"确认",offset:"t",icon:1});_this.step(id)},add:function($dom){layer.alert(_this.prevBtnId($dom),{title:"添加",offset:"t",icon:4})},edit:function($dom){layer.alert(_this.nextBtnId($dom),{title:"编辑",offset:"t",icon:3})},del:function($dom){layer.alert(_this.currBtnId($dom),{title:"删除",offset:"t",icon:2})},jump:function($dom){layer.alert(_this.currBtnId($dom),{title:"跳转",offset:"t",icon:5})}};this.elem_dom.off("click","."+TIMELINE_ITEM).on("click","."+TIMELINE_ITEM,this.tpl_event?this.tpl_event:function(event){event.stopPropagation();btnClick["step"].call(_this,$(this))});this.elem_dom.off("click","."+TIMELINE_BTN).on("click","."+TIMELINE_BTN,function(event){event.stopPropagation();var method=$(this).data("method");btnClick[method]?btnClick[method].call(_this,$(this)):""})};TimeLine.prototype.unbindEvent=function(){this.elem_dom.unbind()};TimeLine.prototype.parseData=function(data){return{axis:function(){return data[this.response.axis]||-1},date:function(){return data[this.response.date]||new Date()},title:function(){return data[this.response.title]||""},contents:function(){return data[this.response.contents]||[]
    },items:function(){return data[this.response.items]||[]},block:function(){return data[this.response.block]||""},submit:function(){return data[this.response.submit]||false},tag:function(){return data[this.response.tag]||null},data:function(){return data}}};TimeLine.prototype.escape=function(html){return event.escape(html)};TimeLine.prototype.unescape=function(str){return event.unescape(str)};TimeLine.prototype.serialize=function(first,param){return AjaxHelper.serialize(first,param)};TimeLine.prototype.template=function(){var tpl_html="";var tpl_url=this.tpl_url;var tpl_id=this.tpl_id;if(tpl_url.length>0){$.ajax({url:tpl_url,async:false,success:function(res){var content=$($.parseHTML(res));var tpl_dom=content.filter("#"+tpl_id);tpl_html=tpl_dom.html()},error:function(res){layer.alert("获取模板文件，<br>异步加载失败，<br> 直接引用本地文件！",{icon:4,title:"Ajax"})}})}if(tpl_html.length>0){this.tpl_html=tpl_html}return tpl_html};TimeLine.prototype.compile=function(){var tpl_data=[];var tpl_ajax=this.tpl_ajax;if(tpl_ajax.length>0){$.ajax({url:tpl_ajax,async:false,type:"post",dataType:"json",contentType:"application/json;charset=utf-8",success:function(res){tpl_data=res},error:function(res){layer.alert("获取模板数据，<br>异步加载失败，<br> 直接编译本地数据！",{icon:4,title:"Ajax"})}})}if(tpl_data.length==0){tpl_data=this.tpl_data}var tpl_html=this.tpl_html;var handlebars=Handlebars.compile(tpl_html);var html=handlebars(tpl_data);this.elem_dom.html(html);this.tpl_data=tpl_data};TimeLine.prototype.register=function(){Handlebars.registerHelper("list",function(items,options){var out="<ul>";for(var i=0,l=items.length;i<l;i++){out=out+"<li>"+options.fn(items[i])+"</li> "}return out+"</ul>"});Handlebars.registerHelper("_if",function(v1,op,v2,options){if(eval(v1+op+v2)){return options.fn(this)}else{return options.inverse(this)}})};TimeLine.prototype.step=function(itemId){var tpl_data=this.tpl_data;for(var i=0;i<tpl_data.length;i++){if(tpl_data[i].id<itemId){tpl_data[i].axis=1}if(tpl_data[i].id==itemId){tpl_data[i].axis=0}if(tpl_data[i].id>itemId){tpl_data[i].axis=-1}}var tpl_html=this.tpl_html;var handlebars=Handlebars.compile(tpl_html);var html=handlebars(tpl_data);this.elem_dom.html(html);this.tpl_data=tpl_data};TimeLine.prototype.size=function(){return this.tpl_data.length};TimeLine.prototype.currBtnId=function($item){var $div=$item.parent("div");if(event.domExist($div)){var $div1=$div.parent("div");if(event.domExist($div1)){var $li=$div1.parent("li");return $li?$li.attr("id"):-1}var $li=$div.parent("li");return $li?$li.attr("id"):-1}return -1};TimeLine.prototype.nextBtnId=function($item){var $div=$item.parent("div");if(event.domExist($div)){var $div1=$div.parent("div");if(event.domExist($div1)){var $li=$div1.parent("li");if(event.domExist($li)){$li=$li.next();return $li?$li.attr("id"):-1}}var $li=$div.parent("li");$li=$li.next();return $li?$li.attr("id"):-1}return -1};TimeLine.prototype.prevBtnId=function($item){var $div=$item.parent("div");if(event.domExist($div)){var $div1=$div.parent("div");if(event.domExist($div1)){var $li=$div1.parent("li");if(event.domExist($li)){$li=$li.prev();return $li?$li.attr("id"):-1}}var $li=$div.parent("li");$li=$li.prev();return $li?$li.attr("id"):-1}return -1};TimeLine.prototype.data=function(){return this.tpl_data};TimeLine.prototype.id=function(tag){var tpl_data=this.tpl_data;for(i=0;i<tpl_data.length;i++){if(tpl_data[i].tag==tag){return tpl_data[i].id}}return -1};TimeLine.prototype.item=function(itemId){var tpl_data=this.tpl_data;for(i=0;i<tpl_data.length;i++){if(tpl_data[i].id==itemId){return tpl_data[i]}}return{}};TimeLine.prototype.axis=function(itemId){var _this=this;if(_this.item(itemId).hasOwnProperty("axis")){return _this.item(itemId).axis}return -1};TimeLine.prototype.date=function(itemId){var _this=this;if(_this.item(itemId).hasOwnProperty("date")){return _this.item(itemId).date}return new Date()};TimeLine.prototype.title=function(itemId){var _this=this;if(_this.item(itemId).hasOwnProperty("title")){return _this.item(itemId).title}return""};TimeLine.prototype.contents=function(itemId){var _this=this;if(_this.item(itemId).hasOwnProperty("contents")){return _this.item(itemId).contents}return[]};TimeLine.prototype.items=function(itemId){var _this=this;if(_this.item(itemId).hasOwnProperty("items")){return _this.item(itemId).items}return[]};TimeLine.prototype.block=function(itemId){var _this=this;if(_this.item(itemId).hasOwnProperty("block")){return _this.item(itemId).block}return""};TimeLine.prototype.submit=function(itemId){var _this=this;if(_this.item(itemId).hasOwnProperty("submit")){return _this.item(itemId).submit}return false};TimeLine.prototype.tag=function(itemId){var _this=this;if(_this.item(itemId).hasOwnProperty("tag")){return _this.item(itemId).tag}return[]};var timeline={set:function(options){if(typeof options!=="undefined"){$.extend(OPTIONS,options)}},render:function(options){var id=event.getElemId(options);if(id==""){layer.msg("页面中未找到绑定id",{icon:5})}else{var _this=TimeLines[id];if(typeof _this==="object"){_this.unbindEvent()
    }_this=new TimeLine();_this.setting(options);_this.init();TimeLines[id]=_this;return _this}return null},reload:function(timeLine,options){if(typeof timeLine==="string"){timeLine=TimeLines[timeLine]}if(typeof timeLine==="undefined"){layer.msg("方法获取失败，请检查ID或对象传递是否正确",{icon:2});return}timeLine.reload(options)},on:function(events,callback){if(events.indexOf("'")>0){events=events.replace(/'/g,"")}if(events.indexOf('"')>0){events=events.replace(/"/g,"")}return layui.onevent.call(this,MOD_NAME,events,callback)},step:function(timeLine,itemId){if(typeof timeLine==="string"){timeLine=TimeLines[timeLine]}if(typeof timeLine==="undefined"){layer.msg("方法获取失败，请检查ID或对象传递是否正确",{icon:2});return}timeLine.step(itemId)},size:function(timeLine){if(typeof timeLine==="string"){timeLine=TimeLines[timeLine]}if(typeof timeLine==="undefined"){layer.msg("方法获取失败，请检查ID或对象传递是否正确",{icon:2});return 0}return timeLine.size()},data:function(timeLine){if(typeof timeLine==="string"){timeLine=TimeLines[timeLine]}if(typeof timeLine==="undefined"){layer.msg("方法获取失败，请检查ID或对象传递是否正确",{icon:2});return[]}return timeLine.data()},id:function(timeLine,tag){if(typeof timeLine==="string"){timeLine=TimeLines[timeLine]}if(typeof timeLine==="undefined"){layer.msg("方法获取失败，请检查ID或对象传递是否正确",{icon:2});return -1}return timeLine.itemId(tag)},item:function(timeLine,itemId){if(typeof timeLine==="string"){timeLine=TimeLines[timeLine]}if(typeof timeLine==="undefined"){layer.msg("方法获取失败，请检查ID或对象传递是否正确",{icon:2});return{}}return timeLine.item(itemId)},axis:function(timeLine,itemId){if(typeof timeLine==="string"){timeLine=TimeLines[timeLine]}if(typeof timeLine==="undefined"){layer.msg("方法获取失败，请检查ID或对象传递是否正确",{icon:2});return -1}return timeLine.axis(itemId)},date:function(timeLine,itemId){if(typeof timeLine==="string"){timeLine=TimeLines[timeLine]}if(typeof timeLine==="undefined"){layer.msg("方法获取失败，请检查ID或对象传递是否正确",{icon:2});return new Date()}return timeLine.date(itemId)},title:function(timeLine,itemId){if(typeof timeLine==="string"){timeLine=TimeLines[timeLine]}if(typeof timeLine==="undefined"){layer.msg("方法获取失败，请检查ID或对象传递是否正确",{icon:2});return""}return timeLine.title(itemId)},contents:function(timeLine,itemId){if(typeof timeLine==="string"){timeLine=TimeLines[timeLine]}if(typeof timeLine==="undefined"){layer.msg("方法获取失败，请检查ID或对象传递是否正确",{icon:2});return[]}return timeLine.contents(itemId)},items:function(timeLine,itemId){if(typeof timeLine==="string"){timeLine=TimeLines[timeLine]}if(typeof timeLine==="undefined"){layer.msg("方法获取失败，请检查ID或对象传递是否正确",{icon:2});return[]}return timeLine.items(itemId)},block:function(timeLine,itemId){if(typeof timeLine==="string"){timeLine=TimeLines[timeLine]}if(typeof timeLine==="undefined"){layer.msg("方法获取失败，请检查ID或对象传递是否正确",{icon:2});return""}return timeLine.block(itemId)},submit:function(timeLine,itemId){if(typeof timeLine==="string"){timeLine=TimeLines[timeLine]}if(typeof timeLine==="undefined"){layer.msg("方法获取失败，请检查ID或对象传递是否正确",{icon:2});return false}return timeLine.submit(itemId)},tag:function(timeLine,itemId){if(typeof timeLine==="string"){timeLine=TimeLines[timeLine]}if(typeof timeLine==="undefined"){layer.msg("方法获取失败，请检查ID或对象传递是否正确",{icon:2});return[]}return timeLine.tag(itemId)},escape:function(html){return event.escape(html)},unescape:function(str){return event.unescape(str)},serialize:function(first,param){return AjaxHelper.serialize(first,param)},version:function(){return VERSION}};exports(MOD_NAME,timeline)});